<!doctype html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="https://studio3d-sit.anker-in.com/anker-viewer/icons/logo.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Anker3D-泛光效果</title>
  <link type="text/css" rel="stylesheet" href="style/main.css">
</head>
<body>

<div id="anker-viewer" style="background: black">
</div>
<div class="info">点击模型部件激活泛光效果</div>

<script type="module">
  //引入SDK
  import * as Anker3D from "../src/index.ts"

  //获取容器
  const container = document.getElementById('anker-viewer');

  //创建查看器
  const viewer = new Anker3D.Viewer(container,{
    modelParams:{//模型参数
      urlOrId:'../models/A2697.glb',//资源路径或者id
      envMapUrl:"../environments/A2697.hdr",//模型环境贴图路径
      onLoad:(model)=>{

        viewer.addComponent(bloomPass);
        bloomPass.applyToObject(model.getObjectByName("20240830-171542"));

        createDebugGUI();
      },
      rotation:[0,180,0]
    }
  });

  let selectObject;
  // 背景色参数
  const debugParams = {
    bloomEnabled:true,
    threshold: 0, strength: 1, radius: 0.5,
  }
  //泛光后处理组件
  const bloomPass = new Anker3D.BloomPassComponent();


  // 挂载到全局 window 对象，便于调试
  window.viewer = viewer;
  window.Anker3D = Anker3D;

  //显示性能监测器
  viewer.showStats();




  //创建调试UI
  function createDebugGUI() {
    const debugPanel = new Anker3D.GUI()


    //泛光
    const bloomFolder = debugPanel.addFolder("泛光");
    bloomFolder.add(debugParams, 'bloomEnabled')
            .name('启用')
            .onChange((checked) => {

              if(checked){
                viewer.addComponent(bloomPass);
              }
              else {
                viewer.removeComponent(bloomPass);
              }
            });
    bloomFolder.add( debugParams, 'threshold', 0.0, 1.0 ).step( 0.01 ).onChange( function ( value ) {
      bloomPass.threshold = Number( value );
    } );

    bloomFolder.add( debugParams, 'strength', 0.0, 3 ).step( 0.01 ).onChange( function ( value ) {
      bloomPass.strength = Number( value );
    } );

    bloomFolder.add( debugParams, 'radius', 0.0, 1.0 ).step( 0.01 ).onChange( function ( value ) {
      bloomPass.radius = Number( value );
    } );

    bloomFolder.open();

  }

  document.body.addEventListener('click',onClick);

  function onClick(e){

    if(debugParams.bloomEnabled){

      const result = viewer.picking.pickObject(e);
      if(result){
        if(selectObject)
          bloomPass.cleaFromObject(selectObject);
        selectObject = result.object;

        bloomPass.applyToObject(result.object);
      }
    }
  }

</script>
</body>
</html>
